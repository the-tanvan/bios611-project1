---
title: "hw4"
author: "Jenna"
date: "10/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(gbm)
library(pROC)
```

```{r include=FALSE}
hw4 = read.csv("source_data/hw4.csv")
analysis = hw4 %>% mutate(Male=(Gender=="Male"))
```
# Problem 1

Build a glm in R to classifier individuals as either Male or Female based on their weight and height.

What is the accuracy of the model?

```{r}
set.seed(1107)
train=sample(c(TRUE,FALSE),nrow(analysis),rep=TRUE)
test=(!train)

train = analysis[train,]
test = analysis[test,]

fit = glm(Male~Weight+Height,data=train,family=binomial())
prediction=(predict(fit,type="response",test)>0.5)
results=as.data.frame(cbind(Truth=test$Male,Prediction=prediction)) %>% mutate(correct=(Truth==Prediction))
table(results$correct)
131/(128+131)
```
# Problem 2

Use the 'gbm' package to train a similar model. Don't worry about hyper parameter tuning for now.

What is the accuracy of the model?

```{r}
head(train)
gbm_model <- gbm(formula = Male ~ Weight+Height, 
                    distribution = "bernoulli", 
                    data = train,
                    n.trees = 1000)
gbm_predict = (predict(gbm_model, newdata=test, n.trees=1000,type="response")>0.5)
gbm_results=as.data.frame(cbind(Truth=test$Male,Prediction=gbm_predict)) %>% mutate(correct=(Truth==Prediction))
table(gbm_results$correct)
123/(124+123)
```


# Problem 3

Filter the data set so that it contains only 50 Male examples. Create a new model for this data set. What is the F1 Score of the model?

```{r}
male = analysis %>% filter(Male==1)
female = analysis %>% filter(Male==0)
filter = rbind(male[1:50,],female)

set.seed(132)
train=sample(c(TRUE,FALSE),nrow(filter),rep=TRUE)
test=(!train)

f_train = analysis[train,]
f_test = analysis[test,]

fit2 = glm(Male~Weight+Height,data=f_train,family=binomial())
prediction2=(predict(fit2,type="response",f_test)>0.5)
results2=as.data.frame(cbind(Truth=f_test$Male,Prediction=prediction2)) %>% mutate(correct=(Truth==Prediction))
table(results2$correct)
117/(130+117)
```


# Problem 4

For the model in the previous example plot an ROC curve. What does this ROC curve mean?
```{r}
prediction_roc=predict(fit2,type="response",f_test)
test_roc = roc(f_test$Male~prediction_roc, plot = TRUE, print.auc = TRUE)
```

# Problem 5

Using K-Means, cluster the same data set. Can you identify the clusters with the known labels? Provide an interpretation of this result.

```{r}
kcluster_df = scale(analysis %>% select(-Gender))
km.res = kmeans(kcluster_df, 2)
print(km.res)
```


